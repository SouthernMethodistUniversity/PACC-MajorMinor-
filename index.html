
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Programs & Suggested Placement Exams</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; line-height: 1.4; }
    .card { max-width: 760px; padding: 1.25rem 1.25rem 1rem; border: 1px solid rgba(127,127,127,.35); border-radius: 14px; }
    label { display:block; font-weight: 600; margin-bottom: .5rem; }
    select { width: 100%; padding: .6rem .7rem; border-radius: 10px; border: 1px solid rgba(127,127,127,.45); font-size: 1rem; }
    .result { margin-top: 1rem; padding: .9rem 1rem; border-radius: 12px; background: rgba(127,127,127,.10); }
    .muted { opacity: .75; font-size: .95rem; margin-top: .35rem; }
    .row { display:flex; gap: .75rem; align-items: baseline; flex-wrap: wrap; }
    .pill { display:inline-block; padding: .15rem .5rem; border-radius: 999px; border: 1px solid rgba(127,127,127,.35); font-size: .85rem; opacity: .85; }
    .error { margin-top: 1rem; padding: .9rem 1rem; border-radius: 12px; border: 1px solid rgba(255,0,0,.35); background: rgba(255,0,0,.08); }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1 style="margin:0 0 .25rem;">Suggested Placement Exams</h1>
    <p class="muted" style="margin:0 0 1rem;">
      Select a program to see the suggested placement exam(s).
    </p>

    <label for="programSelect">Program</label>
    <select id="programSelect" aria-describedby="helpText" disabled>
      <option value="" selected>Loading programs…</option>
    </select>
    <div id="helpText" class="muted">Programs are grouped by majors and minors.</div>

    <section id="output" class="result" aria-live="polite" style="display:none;">
      <div class="row">
        <h2 id="programTitle" style="margin:0; font-size:1.15rem;"></h2>
        <span id="groupPill" class="pill" style="display:none;"></span>
      </div>
      <p id="examText" style="margin:.5rem 0 0;"></p>
    </section>

    <section id="errorBox" class="error" style="display:none;" role="alert">
      <strong>Couldn’t load <code>data.json</code>.</strong>
      <div class="muted" style="margin-top:.35rem;">
        If you opened this HTML file directly from your computer, some browsers block <code>fetch()</code> for local files.
        Try serving the folder with a tiny local web server (examples below).
        <ul style="margin:.5rem 0 0; padding-left: 1.1rem;">
          <li>Python: <code>python -m http.server 8000</code></li>
          <li>Node: <code>npx http-server</code></li>
        </ul>
        Then open: <code>http://localhost:8000/</code>
      </div>
    </section>
  </main>

  <script>
    const selectEl = document.getElementById("programSelect");
    const output = document.getElementById("output");
    const programTitle = document.getElementById("programTitle");
    const examText = document.getElementById("examText");
    const groupPill = document.getElementById("groupPill");
    const errorBox = document.getElementById("errorBox");

    let lookup = new Map();

    function addGroup(label, items) {
      const og = document.createElement("optgroup");
      og.label = label;
      items
        .slice()
        .sort((a, b) => a.program.localeCompare(b.program))
        .forEach(item => {
          const opt = document.createElement("option");
          opt.value = item.program;
          opt.textContent = item.program;
          og.appendChild(opt);
        });
      selectEl.appendChild(og);
    }

    function setLoadingState(isLoading) {
      selectEl.disabled = isLoading;
      selectEl.innerHTML = "";
      const opt = document.createElement("option");
      opt.value = "";
      opt.disabled = true;
      opt.selected = true;
      opt.textContent = isLoading ? "Loading programs…" : "Choose a program…";
      selectEl.appendChild(opt);
    }

    async function init() {
      setLoadingState(true);

      try {
        // IMPORTANT: data.json should be in the same folder as this HTML file.
        const res = await fetch("./data.json", { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        // Build lookup and populate dropdown with optgroups
        lookup = new Map();
        (data.majors || []).forEach(item => lookup.set(item.program, { ...item, group: "Major" }));
        (data.minors || []).forEach(item => lookup.set(item.program, { ...item, group: "Minor" }));

        setLoadingState(false);
        addGroup("Majors", data.majors || []);
        addGroup("Minors", data.minors || []);

        errorBox.style.display = "none";
      } catch (err) {
        console.error(err);
        setLoadingState(true);
        errorBox.style.display = "block";
      }
    }

    selectEl.addEventListener("change", (e) => {
      const program = e.target.value;
      const record = lookup.get(program);

      if (!record) {
        output.style.display = "none";
        return;
      }

      programTitle.textContent = record.program;
      examText.textContent = record.suggested_placement_exams;

      groupPill.textContent = record.group;
      groupPill.style.display = "inline-block";

      output.style.display = "block";
    });

    init();
  </script>
</body>
</html>
